var article_array,link_target,redirection_counter=-1,debug=!0,page=0,pos_focus=0,window_status="article-list",content_arr=[],source_array=[],k=0,panels=["all"],current_panel=0,log_data=[],log=!0,activity=!1,volume_status=!1,rss_title="";$(document).ready(function(){function t(){var t=new Applait.Finder({type:"sdcard",debugMode:!1});t.on("empty",function(t){toaster("no sdcard found")}),t.search("rss-reader.json"),t.on("searchComplete",function(t,e){0==e&&$("#download").html("ðŸ˜´<br>No json file founded")}),t.on("fileFound",function(t,a,s){var o=new FileReader;o.onerror=function(t){toaster("shit happens"),o.abort()},o.onloadend=function(t){var a;try{a=JSON.parse(t.target.result)}catch(t){return $("#download").html("ðŸ˜´<br>Your json file is not valid"),!1}$.each(a,function(t,e){e.categorie||(e.categorie=0),source_array.push([e.url,e.limit,e.channel,e.categorie])}),navigator.onLine?e(source_array[0][0],source_array[0][1],source_array[0][2],source_array[0][3]):$("#download").html("ðŸ˜´<br>Your device is offline, please connect it to the internet ")},o.readAsText(t)})}function e(t,s,o,r){function i(){}function n(){toaster("failed"+o,1e3)}function c(t){if(""==rss_type&&!0===activity)return $("#download").html("The content is <br>not a valid rss feed <div style='font-size:2rem;margin:8px 0 0 0;color:white!Important;'>Â¯&#92;_(ãƒ„)_/Â¯</div><br>"),!1;k==source_array.length-1&&(setTimeout(()=>{a(),cache.saveCache(content_arr)},1500),!0===log&&(delete_file("rss_log.txt"),setTimeout(()=>{var t=new Date,e=t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes();write_file(log_data.toString()+e,"rss_log.txt")},2e3))),k<source_array.length-1&&(k++,e(source_array[k][0],source_array[k][1],source_array[k][2],source_array[k][3]))}var l=new XMLHttpRequest({mozSystem:!0});l.open("GET",t,!0),l.withCredentials=!0,l.timeout=2e3,l.setRequestHeader("Cache-control","public, max-age=31536000"),l.responseType="document",l.overrideMimeType("text/xml"),l.send(null),$("div#message-box").css("display","block"),l.addEventListener("load",i),l.addEventListener("error",n),l.addEventListener("loadend",c),l.onload=function(){if(log_data.push(["",l.staus,o,"\n"]),l.readyState===l.DONE&&200===l.status){var t=l.response;rss_type="",rss_title=$(t).find("title:first").text();let e=k+" / "+source_array.length;$("#download").html("downloading<br><br>"+rss_title),$("div#count").text(e),$(t).find("entry").each(function(t){if(rss_type="atom",t<s){var e=$(this).find("title").text(),a=$(this).find("summary").text(),i="",n="";""==a&&(a=$(this).find("media\\:description").text(),i=$(this).find("media\\:thumbnail").attr("url"),n=$(this).find("yt\\:videoId").text()),""==a&&(a=$(this).find("content").text());var c=$(this).find("link").attr("href"),l=$(this).find("enclosure").attr("url"),d=Date.parse($(this).find("updated").text());item_date=new Date(d),item_date=item_date.toGMTString();var u=$(this).find("enclosure").attr("type");content_arr.push([e,a,c,item_date,d,o,r,l,u,i,n])}}),$(t).find("item").each(function(t){if(rss_type="rss",t<s){var e=$(this).find("title").text(),a=$(this).find("description").text(),i=$(this).find("link").text(),n=Date.parse($(this).find("pubDate").text());item_date=new Date(n),item_date=item_date.toGMTString();var c=$(this).find("enclosure").attr("url"),l=$(this).find("enclosure").attr("type");content_arr.push([e,a,i,item_date,n,o,r,c,l])}})}404===l.status&&(toaster(o+" url not found",3e3),log_data.push(["url not found",l.staus,o,"\n"])),408===l.status&&(toaster(o+"Time out",3e3),log_data.push(["timeout",l.staus,o,"\n"])),409===l.status&&toaster(o+"Conflict",3e3),301===l.status&&(toaster(o+" redirection",3e3),e(l.getResponseHeader("Location"),s,o)),l.ontimeout=function(t){toaster(o+"Time out",3e3),log_data.push(["timeout",o,"\n"])},0===l.status&&toaster(o+" status: "+l.status+l.getAllResponseHeaders(),3e3),200!==l.status&&log_data.push([l.getResponseHeader("Location"),l.staus,o,"\n"])}}function a(){$("div#navigation div").text(panels[0]),$.each(content_arr,function(t,e){var a=content_arr[t][4],s=content_arr[t][2],o=content_arr[t][5],r=content_arr[t][3],i=content_arr[t][0],n=content_arr[t][1],c=content_arr[t][6],l=content_arr[t][7],d=content_arr[t][8],u=content_arr[t][9],p=content_arr[t][10],f=" rss";!1===panels.includes(c)&&0!=c&&panels.push(c),"audio/mpeg"!=d&&"audio/aac"!=d||(f=" podcast"),!0===s.includes("https://www.youtube.com")&&(f=" youtube",s="https://www.youtube.com/embed/"+p+"?enablejsapi=1&autoplay=1");var v='<article class="'+c+f+' all" data-order = "'+a+'" data-link = "'+s+'" data-youtube-id= "'+p+'" data-download="'+l+'"data-audio-type="'+d+'"><div class="flex grid-col-10"><div class="podcast-icon"><img src="assets/image/podcast.png"></div><div class="youtube-icon"><img src="assets/image/youtube.png"></div></div><div class="channel">'+o+"</div><time>"+r+'</time><h1 class="title">'+i+'</h1><div class="summary">'+n+'<img src="'+u+'"></div></article>';$("div#news-feed-list").append(v),$("div#news-feed-list article:first").focus(),article_array=$("div#news-feed-list article")}),o(),$("div#message-box").slideDown("400",function(){$("div#message-box").css("display","none")})}function s(){$("article").removeAttr("tabindex"),$("article").filter(":visible").each(function(t){$(this).prop("tabindex",t)}),article_array=$("article").filter(":visible"),$("body").find("article[tabindex = 0]").focus(),$("article:last").css("margin","0 0 30px 0")}function o(){var t=$("div#news-feed-list");t.find("article").sort(function(t,e){return+e.dataset.order-+t.dataset.order}).appendTo(t),article_array=$("div#news-feed-list article"),s()}function r(t){$("article").css("display","none"),$("article."+t).css("display","block"),$("div#app-panels article").find([tabindex="0"]).focus()}function i(t){"left"==t&&current_panel--,"right"==t&&current_panel++,current_panel%=panels.length,current_panel<0&&(current_panel+=panels.length),$("div#navigation div").text(panels[current_panel]),r(panels[current_panel]),s(),pos_focus=0}function n(t){var e=$("div#settings [tabIndex]");if("settings"==window_status){if("+1"==t&&pos_focus<e.length-1){pos_focus++;var a=e[pos_focus];a.focus();var s=$(":focus")[0].offsetTop+20;window.scrollTo({top:s,left:100,behavior:"smooth"})}if("-1"==t&&pos_focus>0){pos_focus--;a=e[pos_focus];a.focus();s=$(":focus")[0].offsetTop-20;window.scrollTo({top:s,left:100,behavior:"smooth"})}}if("article-list"==window_status){$(":focus")[0];if("+1"==t&&pos_focus<article_array.length-1&&(pos_focus++,pos_focus<=article_array.length)){s=$(":focus")[0].offsetTop+20;window.scrollTo({top:s,left:100,behavior:"smooth"});a=article_array[pos_focus];a.focus()}if("-1"==t&&pos_focus>0&&(pos_focus--,pos_focus>=0)){a=article_array[pos_focus];a.focus();s=$(":focus")[0].offsetTop;window.scrollTo({top:s+20,behavior:"smooth"})}}}function c(t,e){function a(t){if(t.lengthComputable){var e=t.loaded/t.total*100;toaster(e,1e3)}else toaster("loading....",1e3)}var s=new XMLHttpRequest({mozSystem:!0});s.open("GET",t,!0),s.withCredentials=!0,s.responseType="blob",toaster("download started",3e3),s.onload=function(){if(s.readyState===s.DONE&&200===s.status){var t=s.response,a=navigator.getDeviceStorage("music"),o=new Blob([t],{type:"audio/mpeg"});toaster("done",3e3);var r=a.addNamed(o,e+".mp3");r.onsuccess=function(){notify("RSS - Reader","successfully wrote on the storage area",!1,!1)},r.onerror=function(){alert("Unable to write the file: "+this.error)}}404===s.status&&toaster(" url not found"+s.getAllResponseHeaders(),3e3),301===s.status&&toaster(" redirection",3e3),0===s.status&&toaster(" status: "+s.status+s.getAllResponseHeaders(),3e4)},s.onerror=function(){toaster(" status: "+s.status+s.getAllResponseHeaders(),3e3)},s.addEventListener("progress",a),s.send(null)}function l(){var t=$("div#input-wrapper #time").val();""!=t?(localStorage.setItem("interval",t),toaster("saved",3e3)):toaster("please fill in all fields",3e3)}function d(){navigator.spatialNavigationEnabled=!1,$("div#navigation").css("display","none"),$("div#news-feed").css("padding","5px 5px 30px 5px");var t=article_array[pos_focus];link_target=$(t).data("download"),link_type=$(t).data("audio-type"),$(":focus").hasClass("podcast")&&($(":focus").hasClass("audio-playing")?bottom_bar("pause","","download"):bottom_bar("play","","download")),($(":focus").hasClass("rss")||$(":focus").hasClass("youtube"))&&bottom_bar("","","visit source"),window.scrollTo(0,0);var e=$(":focus");$("article").css("display","none"),e.css("display","block"),$("div.summary").css("display","block"),$("div#bottom-bar").css("display","block"),$("div#settings").css("display","none"),window_status="single-article"}function u(){$("div#navigation").css("display","none"),$("div#news-feed").css("padding","5px 5px 30px 5px"),pos_focus=0,$("article").css("display","none"),$("div#settings").css("display","block"),bottom_bar("save","","back"),$("div#bottom-bar").css("display","block"),$("div#input-wrapper input#time").focus(),null!=localStorage.getItem("interval")&&(document.getElementById("time").value=localStorage.getItem("interval")),window_status="settings"}function p(){navigator.spatialNavigationEnabled=!1,$("div#source-page div#iframe-wrapper").removeClass("video-view"),$("div#navigation").css("display","block"),$("div#news-feed").css("padding","35px 5px 30px 5px"),$("article").css("display","block"),$("div.summary").css("display","none"),$("div#bottom-bar").css("display","block"),$("div#settings").css("display","none"),r(panels[current_panel]),s();var t=article_array[pos_focus];t.focus(),window.scrollTo(0,$(t).offset().top),$("div#source-page").css("display","none"),$("div#source-page iframe").attr("src",""),activity?bottom_bar("add","select",""):bottom_bar("settings","select",""),window_status="article-list"}function f(){var t=article_array[pos_focus],e=$(t).data("link"),a=$(t).data("download"),s=$(t).find("h1.title").text();if(s=s.replace(/\s/g,"-"),$(":focus").hasClass("rss"))return $("div.summary").css("display","none"),$("div#source-page").css("display","block"),$("div#source-page iframe").attr("src",e),$("div#bottom-bar").css("display","none"),$("div#source-page div#iframe-wrapper").css("height","1000vh"),$("div#source-page iframe").css("height","1000vh"),void(window_status="source-page");if($(":focus").hasClass("youtube"))return $("div.summary").css("display","none"),$("div#source-page").css("display","block"),$("div#source-page iframe").attr("src",e),$("div#bottom-bar").css("display","none"),$("div#source-page div#iframe-wrapper").css("height","100vh"),$("div#source-page iframe").css("height","100vh"),$("div#source-page div#iframe-wrapper").addClass("video-view"),navigator.spatialNavigationEnabled=!0,window_status="source-page",void(player.src="");if($(":focus").hasClass("podcast")){var o=new Applait.Finder({type:"music",debugMode:!1});return o.on("empty",function(t){toaster("no sdcard found")}),o.search(s),o.on("fileFound",function(t,e,a){return toaster("The file is already available",3e3),!1}),void o.on("searchComplete",function(t,e){0==e&&c(a,s)})}}function v(t){switch(t.key){case"Enter":"article-list"==window_status&&d(),"settings"==window_status&&$("input[type=checkbox]").is(":focus")&&($("input[type=checkbox]").is(":checked")?($("input[type=checkbox]").prop("checked",!1),setting_status="false",removeAlarms()):($("input[type=checkbox]").prop("checked",!0),setting_status="true"),l());break;case"ArrowLeft":"article-list"==window_status&&i("left"),"single-article"==window_status&&seeking("backward");break;case"ArrowRight":"article-list"==window_status&&i("right"),"single-article"==window_status&&seeking("forward");break;case"ArrowDown":n("+1"),!0===volume_status&&volume_control("down");break;case"ArrowUp":n("-1"),!0===volume_status&&volume_control("up");break;case"#":volume.requestShow(),volume_status=!0,navigator.spatialNavigationEnabled=!1;break;case"SoftLeft":if("article-list"==window_status)return void(activity?(toaster(source_array[0][0],3e3),add_source(source_array[0][0],5,"all",rss_title)):u());if("single-article"==window_status&&$(":focus").hasClass("podcast"))return void play_podcast();if("settings"==window_status)return void l();break;case"SoftRight":if("single-article"==window_status)return void f();if("settings"==window_status)return void p();break;case"Backspace":if(t.preventDefault(),"article-list"==window_status)return void window.close();if("settings"==window_status)return void p();if("single-article"==window_status)return void p();if("source-page"==window_status)return void p()}}setTimeout(()=>{if(!1===activity){let e=localStorage.getItem("interval");null==e&&(e=0),cache.getTime(e)?(t(),toaster("download",5e3)):(content_arr=cache.loadCache(),a(),toaster("load from cache",5e3))}},4e3),navigator.mozSetMessageHandler("activity",function(t){var a=t.source;if(activity=!0,"view"==a.name){for(;source_array.length>0;)source_array.pop();source_array.push([a.data.url,4,"","all"]),e(source_array[0][0],source_array[0][1],source_array[0][2],source_array[0][3]),bottom_bar("add","select","")}});bottom_bar("settings","select",""),document.addEventListener("keydown",v),debug&&$(window).on("error",function(t){console.log("jQuery error event:",t);var e=t.originalEvent;console.log("original event:",e),e.message?alert("Error:\n\t"+e.message+"\nLine:\n\t"+e.lineno+"\nFile:\n\t"+e.filename):alert("Error:\n\t"+e.type+"\nElement:\n\t"+(e.srcElement||e.target))})});